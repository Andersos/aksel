import React, { PropTypes as PT } from 'react';
import sanitize from 'sanitize-html';

const leggTilLenkerTags = (innhold) => {
    const uriRegex = /(([\w-]+:\/\/?|www(?:-\w+)?\.)[^\s()<>]+\w)/g;
    const httpRegex = /^(https?):\/\/.*$/;

    return innhold.replace(uriRegex, (match) => {
        const matched = match.match(httpRegex) ? match : `http://${match}`;
        return `<a target="_blank" href="${matched}">${matched}</a>`;
    });
};

const safeHtml = (content) => sanitize(content, { allowedTags: ['a'] });

const tilAvsnitt = (avsnitt, index) => (
    <p dangerouslySetInnerHTML={{ __html: safeHtml(avsnitt) }} key={index} /> // eslint-disable-line react/no-danger
);

function Tekstomrade({ children, ingenFormattering, ...props }) {
    const tekst = children || '';
    const avsnitt = ingenFormattering ? tekst : tekst.split(/[\r\n]+/)
        .map(leggTilLenkerTags)
        .map(tilAvsnitt);

    return <div {...props}>{avsnitt}</div>;
}

Tekstomrade.propTypes = {
    children: PT.string,
    ingenFormattering: PT.bool
};

export default Tekstomrade;
