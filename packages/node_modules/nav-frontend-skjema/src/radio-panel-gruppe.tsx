import * as React from 'react';
import * as PT from 'prop-types';
import * as classNames from 'classnames';
import { guid } from 'nav-frontend-js-utils';
import { SkjemaGruppe, SkjemaelementFeilmelding } from './';
import 'nav-frontend-skjema-style';

export interface RadioPanelProps extends React.InputHTMLAttributes<HTMLInputElement> {
    label: React.ReactNode;
}

export interface RadioPanelState {
    hasFocus: boolean;
}

export class RadioPanel extends React.Component<RadioPanelProps, RadioPanelState> {
    constructor(props: RadioPanelProps) {
        super(props);
        this.state = { hasFocus: false };
    }

    toggleOutline() {
        this.setState({ hasFocus: !this.state.hasFocus });
    }

    render() {
        const { id, label, checked, disabled, ...other } = this.props;
        const { hasFocus } = this.state;
        const inputId = id || guid();

        const cls = classNames('inputPanel radioPanel', {
            'inputPanel--checked': checked && !disabled,
            'inputPanel--focused': hasFocus && !disabled,
            'inputPanel--disabled': disabled === true
        });

        return (
            <label className={cls} htmlFor={inputId}>
                <input
                    id={inputId}
                    className="inputPanel__field"
                    type="radio"
                    checked={checked}
                    aria-checked={checked}
                    disabled={disabled}
                    {...other}
                    onFocus={() => this.toggleOutline()}
                    onBlur={() => this.toggleOutline()}
                />
                <span className="inputPanel__label">{label}</span>
            </label>
        );
    }
}

export interface RadioPanelGruppeProps {
    radios: RadioPanelProps[];
    name: string;
    legend?: React.ReactNode;
    onChange: (event: React.SyntheticEvent<EventTarget>, value: any) => void;
    className?: string;
    checked?: string;
    feil?: React.ReactNode | boolean;
}

class RadioPanelGruppe extends React.Component<RadioPanelGruppeProps> {
    render() {
        const { radios, name, legend, feil, checked, onChange, className, ...other } = this.props;
        const cls = classNames('inputPanelGruppe', className);
        const errorId = guid();
        return (
            <SkjemaGruppe
                className={cls}
                legend={legend}
                feil={feil}
                errorId={errorId}
                {...other}
            >
                <div className="inputPanelGruppe__inner">
                    {radios.map((radio: RadioPanelProps) => (
                        <RadioPanel
                            name={name}
                            key={`${name}-${radio.value}`}
                            checked={checked === radio.value}
                            onChange={(event: React.SyntheticEvent<EventTarget>) => onChange(event, radio.value)}
                            aria-invalid={!!feil}
                            aria-describedby={errorId}
                            {...radio}
                        />
                    ))}
                </div>
            </SkjemaGruppe>
        );
    }
}

(RadioPanelGruppe as React.ComponentClass).propTypes = {
    radios: PT.array.isRequired,
    name: PT.string.isRequired,
    legend: PT.node,
    onChange: PT.func.isRequired,
    className: PT.string,
    feil: PT.oneOfType([PT.node, PT.bool])
};

(RadioPanelGruppe as React.ComponentClass).defaultProps = {
    feil: undefined
};

export default RadioPanelGruppe;
