import PT from 'prop-types';
import { Component } from 'react';
import _throttle from 'lodash.throttle';

export class EventThrottler extends Component { // eslint-disable-line import/prefer-default-export
    componentDidMount() {
        this.throttled = _throttle(this.props.callback, this.props.delay, { leading: false });
        window.addEventListener(this.props.event, this.throttled);
    }

    componentWillUnmount() {
        if (this.throttled) {
            window.removeEventListener(this.props.event, this.throttled);
        }
    }

    render() {
        return this.props.children;
    }
}

EventThrottler.propTypes = {
    children: PT.oneOfType([
        PT.arrayOf(PT.node),
        PT.node
    ]).isRequired,
    callback: PT.func.isRequired,
    delay: PT.number,
    event: PT.oneOf(['resize'])
};

EventThrottler.defaultProps = {
    callback: () => {},
    delay: 0,
    event: 'resize'
};
