import React, { Component } from 'react';
import { PropTypes as PT } from 'prop-types';
import classNames from 'classnames';
import { Infotekst } from 'nav-frontend-typografi';
import Lukknapp from 'nav-frontend-lukknapp';
import 'nav-frontend-hjelpetekst-style'; // eslint-disable-line import/extensions
import Ikon from 'nav-frontend-ikoner-assets'; // eslint-disable-line import/extensions


const cls = (type, className) => classNames('hjelpetekst', className, {
    'hjelpetekst--under': type === 'under',
    'hjelpetekst--over': type === 'over',
    'hjelpetekst--hoyre': type === 'hoyre',
    'hjelpetekst--venstre': type === 'venstre'
});

function DefaultAnchor(props) {
    return <Ikon kind={props.hover ? 'help-circle_hover' : 'help-circle'} className={props.className} />;
}

DefaultAnchor.propTypes = {
    className: PT.string.isRequired,
    hover: PT.bool.isRequired
};

class HjelpetekstBase extends Component {
    constructor(props) {
        super(props);

        this.toggleSynlighet = this.toggleSynlighet.bind(this);
        this.stateChange = this.stateChange.bind(this);

        this.state = {
            erSynlig: false,
            hover: false,
            focus: false,
            active: false
        };
    }

    toggleSynlighet() {
        event.preventDefault();
        event.stopPropagation();
        this.setState({
            erSynlig: !this.state.erSynlig

        }, () => (this.state.erSynlig ? this.lukkeKnapp.focus() : this.apneKnapp.focus()));
    }

    stateChange(state, value) {
        return () => this.setState({ [state]: value });
    }

    renderContent() {
        return (
            <div
                tabIndex="-1"
                ref={(div) => { this.lukkeKnapp = div; }}
                className={cls(this.props.type, this.props.className)}
            >
                <Infotekst>
                    {this.props.children}
                </Infotekst>
                <Lukknapp
                    altTekst="Lukk hjelpetekst"
                    bla
                    overstHjorne
                    onClick={this.toggleSynlighet}
                />
            </div>
        );
    }

    render() {
        const Hjelpetekst = this.state.erSynlig ? this.renderContent() : null;
        const Anchor = this.props.anchor;

        return (
            <div className="hjelpetekst__container">
                <button
                    ref={(button) => { this.apneKnapp = button; }}
                    className="hjelpetekst__apneknapp"
                    onClick={this.toggleSynlighet}
                    onMouseEnter={this.stateChange('hover', true)}
                    onMouseLeave={this.stateChange('hover', false)}
                    onFocus={this.stateChange('focus', true)}
                    onBlur={this.stateChange('focus', false)}
                    onMouseDown={this.stateChange('active', true)}
                    onMouseUp={this.stateChange('active', false)}
                    title={this.props.tittel}
                    aria-pressed={this.state.erSynlig}
                >
                    <Anchor
                        className="hjelpetekst__anchor"
                        hover={this.state.hover}
                        focus={this.state.focus}
                        active={this.state.active}
                    />
                </button>
                {Hjelpetekst}
            </div>
        );
    }
}


HjelpetekstBase.propTypes = {
    children: PT.node.isRequired,
    type: PT.oneOf(['over', 'under', 'hoyre', 'venstre']).isRequired,
    tittel: PT.string,
    className: PT.string,
    anchor: PT.func
};

HjelpetekstBase.defaultProps = {
    tittel: 'Hjelptekst',
    className: undefined,
    anchor: DefaultAnchor
};

export default HjelpetekstBase;

export const HjelpetekstOver = (props) => <HjelpetekstBase type="over" {...props} />;
export const HjelpetekstUnder = (props) => <HjelpetekstBase type="under" {...props} />;
export const HjelpetekstHoyre = (props) => <HjelpetekstBase type="hoyre" {...props} />;
export const HjelpetekstVenstre = (props) => <HjelpetekstBase type="venstre" {...props} />;
